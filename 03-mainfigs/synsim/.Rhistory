) +
geom_errorbar(
aes(
group = strain,
ymin = avg_delta_od - ser_delta_od,
ymax = avg_delta_od + ser_delta_od
),
position = position_dodge(width = col_width),
width = 25
) +
scale_x_continuous(breaks = c(0, 250, 500)) +
scale_fill_manual(values = chroma_cl) +
theme_pubr() +
theme(legend.position = "none") +
labs(
title = "PE vs PPE: delta OD",
x = "Pressure (bar) for 24 h @ 37°C",
y = "Change in OD600"
)
ggsave("/Users/jwinnikoff/Documents/MBARI/deeplipid-biophys-2022/biocurvature/20220119_PEPPE/20220421_PEPPE_delta_OD600.pdf", width = 4, height = 4)
file_od600 = "/Users/jwinnikoff/Documents/MBARI/Lipids/Ecoli/20220328_PEPC/20220328_PEPC_OD600.tsv"
col_width = 150
# lipid class colors
chroma_cl = c(
brewer.pal(4, "Blues")[2:4], #PCs
brewer.pal(4, "Greens")[2:4], #PEs
brewer.pal(12, "Paired")[5:12] #PSs
) %>%
setNames(
c(
"P-PC", "PC", "LPC",
"P-PE", "PE", "LPE",
"PS", "LPS",
"DG",
"PI",
"SM",
"Cer",
"PG", "TG"
)
)
data_ecoli = file_od600 %>%
read_tsv() %>%
mutate(
delta_od = od_end - od_beg,
doubling = log(od_end / od_beg, 2),
strain = factor(strain, levels = c("PE", "PC"))
)
data_ecoli_summ = data_ecoli %>%
group_by(strain, press_set, press_act) %>%
summarize(
avg_delta_od = mean(delta_od),
ser_delta_od = sd(delta_od)/sqrt(n()),
avg_doubling = mean(doubling),
ser_doubling = sd(doubling)/sqrt(n())
)
# plot growth
data_ecoli_summ %>%
ggplot(aes(x = press_set, y = avg_delta_od, fill = strain)) +
geom_col(
position = position_dodge(),
width = col_width
) +
geom_point(
data = data_ecoli,
aes(y = delta_od),
position = position_jitterdodge(
jitter.width = 20,
dodge.width = col_width
),
color = "black"#,
#shape = 'o'
) +
geom_errorbar(
aes(
group = strain,
ymin = avg_delta_od - ser_delta_od,
ymax = avg_delta_od + ser_delta_od
),
position = position_dodge(width = col_width),
width = 25
) +
scale_x_continuous(breaks = c(0, 250, 500)) +
scale_fill_manual(values = chroma_cl) +
theme_pubr() +
theme(legend.position = "none") +
labs(
title = "PE vs PC: delta OD",
x = "Pressure (bar) for 24 h @ 37°C",
y = "Change in OD600"
)
ggsave("/Users/jwinnikoff/Documents/MBARI/Lipids/Ecoli/20220328_PEPC/20220329_PEPC_delta_OD600.pdf", width = 4, height = 4)
ggsave("/Users/jwinnikoff/Documents/MBARI/deeplipid-biophys-2022/biocurvature/20220328_PEPC/20220329_PEPC_delta_OD600.pdf", width = 4, height = 4)
# plot doublings
data_ecoli_summ %>%
ggplot(aes(x = press_set, y = avg_doubling, fill = strain)) +
geom_col(
position = position_dodge(),
width = col_width
) +
geom_point(
data = data_ecoli,
aes(y = doubling),
position = position_jitterdodge(
dodge.width = col_width
),
color = "black",
shape = 'o'
) +
geom_errorbar(
aes(
group = strain,
ymin = avg_doubling - ser_doubling,
ymax = avg_doubling + ser_doubling
),
position = position_dodge(width = col_width),
width = 25
) +
scale_x_continuous(breaks = c(0, 250, 500)) +
scale_fill_manual(values = chroma_cl) +
theme_pubr() +
theme(legend.position = "none") +
labs(
title = "PE vs PC: doublings by OD600",
x = "Pressure (bar) for 24 h @ 37°C",
y = "Doublings"
)
file_od600 = "/Users/jwinnikoff/Documents/MBARI/deeplipid-biophys-2022/biocurvature/20220119_PEPPE/pPE_growth_compare.tsv"
col_width = 150
# lipid class colors
chroma_cl = c(
brewer.pal(4, "Blues")[2:4], #PCs
brewer.pal(4, "Greens")[2:4], #PEs
brewer.pal(12, "Paired")[5:12] #PSs
) %>%
setNames(
c(
"P-PC", "PC", "LPC",
"P-PE", "PE", "LPE",
"PS", "LPS",
"DG",
"PI",
"SM",
"Cer",
"PG", "TG"
)
)
data_ecoli = file_od600 %>%
read_tsv() %>%
# some wrangling not needed for the PEPC datafile
filter(strain %in% c("pET28", "PlsCP")) %>%
group_by(strain, press, rep) %>%
arrange(time) %>%
pivot_wider(values_from = OD, names_from = "time", names_prefix = "od_") %>%
rename(
od_beg = od_0,
od_end = od_24
) %>%
mutate(
delta_od = od_end - od_beg,
doubling = log(od_end / od_beg, 2),
strain = ifelse(wild, "PE", "PPE")
)
data_ecoli_summ = data_ecoli %>%
group_by(strain, press) %>%
summarize(
avg_delta_od = mean(delta_od),
ser_delta_od = sd(delta_od)/sqrt(n()),
avg_doubling = mean(doubling),
ser_doubling = sd(doubling)/sqrt(n())
)
# plot doublings
data_ecoli_summ %>%
ggplot(aes(x = press_set, y = avg_doubling, fill = strain)) +
geom_col(
position = position_dodge(),
width = col_width
) +
geom_point(
data = data_ecoli,
aes(y = doubling),
position = position_jitterdodge(
dodge.width = col_width
),
color = "black",
shape = 'o'
) +
geom_errorbar(
aes(
group = strain,
ymin = avg_doubling - ser_doubling,
ymax = avg_doubling + ser_doubling
),
position = position_dodge(width = col_width),
width = 25
) +
scale_x_continuous(breaks = c(0, 250, 500)) +
scale_fill_manual(values = chroma_cl) +
theme_pubr() +
theme(legend.position = "none") +
labs(
title = "PE vs PC: doublings by OD600",
x = "Pressure (bar) for 24 h @ 37°C",
y = "Doublings"
)
# plot doublings
data_ecoli_summ %>%
ggplot(aes(x = press, y = avg_doubling, fill = strain)) +
geom_col(
position = position_dodge(),
width = col_width
) +
geom_point(
data = data_ecoli,
aes(y = doubling),
position = position_jitterdodge(
dodge.width = col_width
),
color = "black",
shape = 'o'
) +
geom_errorbar(
aes(
group = strain,
ymin = avg_doubling - ser_doubling,
ymax = avg_doubling + ser_doubling
),
position = position_dodge(width = col_width),
width = 25
) +
scale_x_continuous(breaks = c(0, 250, 500)) +
scale_fill_manual(values = chroma_cl) +
theme_pubr() +
theme(legend.position = "none") +
labs(
title = "PE vs PC: doublings by OD600",
x = "Pressure (bar) for 24 h @ 37°C",
y = "Doublings"
)
file_od600 = "/Users/jwinnikoff/Documents/MBARI/Lipids/Ecoli/20220328_PEPC/20220328_PEPC_OD600.tsv"
col_width = 150
# lipid class colors
chroma_cl = c(
brewer.pal(4, "Blues")[2:4], #PCs
brewer.pal(4, "Greens")[2:4], #PEs
brewer.pal(12, "Paired")[5:12] #PSs
) %>%
setNames(
c(
"P-PC", "PC", "LPC",
"P-PE", "PE", "LPE",
"PS", "LPS",
"DG",
"PI",
"SM",
"Cer",
"PG", "TG"
)
)
file_od600 = "/Users/jwinnikoff/Documents/MBARI/deeplipid-biophys-2022/biocurvature/20220119_PEPPE/pPE_growth_compare.tsv"
col_width = 150
# lipid class colors
chroma_cl = c(
brewer.pal(4, "Blues")[2:4], #PCs
brewer.pal(4, "Greens")[2:4], #PEs
brewer.pal(12, "Paired")[5:12] #PSs
) %>%
setNames(
c(
"P-PC", "PC", "LPC",
"P-PE", "PE", "LPE",
"PS", "LPS",
"DG",
"PI",
"SM",
"Cer",
"PG", "TG"
)
)
data_ecoli = file_od600 %>%
read_tsv() %>%
# some wrangling not needed for the PEPC datafile
filter(strain %in% c("pET28", "PlsCP")) %>%
group_by(strain, press, rep) %>%
arrange(time) %>%
pivot_wider(values_from = OD, names_from = "time", names_prefix = "od_") %>%
rename(
od_beg = od_0,
od_end = od_24
) %>%
mutate(
delta_od = od_end - od_beg,
doubling = log(od_end / od_beg, 2),
strain = ifelse(wild, "PE", "PPE")
)
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(pbapply)
library(lubridate)
# locate data files
dir_head = "/Users/jwinnikoff/Documents/MBARI/SAXS/humblebragg/01-series/"
dirs_sub = c("S1_PE", "S2_PE-pPE", "S3_pPE")
patt_dat = "\\.dat"
files_data = list.files(paste(dir_head, dirs_sub, "/01-raw", sep=''), patt_dat, full.names = TRUE)
# load .dat file output by BIOXTAS-RAW, return profile dataframe and metadata JSON object
load_saxsdat <- function(file){
# read profile data
scatdat <- file %>%
read_delim(
delim = ' ',
comment = '#',
col_names = c("q", "iq", "err"),
col_types = list(col_double(), col_double(), col_double()),
trim_ws = TRUE
) %>%
mutate_all(as.numeric)
# read header data
header <- file %>%
read_file() %>%
sub(".*### HEADER:", '', .) %>%
gsub('#', '', .) %>%
rjson::fromJSON()
return(list("data" = scatdat, "header" = header))
}
data_saxs_PE_pPE <- files_data %>%
pblapply(
cl = NULL,
function(file){
# parse metadata from filename
metadata <- basename(file) %>%
strsplit('_') %>% .[[1]] %>%
.[1:5] %>%
setNames(c("samp", "press", "pdir", "temp", "rep")) %>%
bind_rows()
# load [meta]data from file
datahead <- quietly(load_saxsdat)(file)$result
# bind all metadata and return
datahead$data %>%
bind_cols(metadata) %>%
bind_cols(tibble(
datetime = datahead$header$counters$date,
filename = datahead$header$filename
))
}
) %>%
bind_rows() %>%
# clean up press and temp columns
mutate(across(c(press, temp), ~as.numeric(gsub("[^0-9.-]", "", .x)))) %>%
# convert MPa to bar
mutate(
press = press*10,
datetime = parse_date_time(datetime, orders = "%a %B %d %H:%M:%S %Y")
) %>%
# group by run
group_by(datetime, pdir, press, temp, rep)
files_data = list.files(paste(dir_head, dirs_sub, "/01-raw", sep=''), patt_dat, full.names = TRUE)
# locate data files
dir_head = "/Users/jwinnikoff/Documents/MBARI/SAXS/humblebragg/series/"
dirs_sub = c("S1_PE", "S2_PE-pPE", "S3_pPE")
patt_dat = "\\.dat"
files_data = list.files(paste(dir_head, dirs_sub, "/01-raw", sep=''), patt_dat, full.names = TRUE)
# load .dat file output by BIOXTAS-RAW, return profile dataframe and metadata JSON object
load_saxsdat <- function(file){
# read profile data
scatdat <- file %>%
read_delim(
delim = ' ',
comment = '#',
col_names = c("q", "iq", "err"),
col_types = list(col_double(), col_double(), col_double()),
trim_ws = TRUE
) %>%
mutate_all(as.numeric)
# read header data
header <- file %>%
read_file() %>%
sub(".*### HEADER:", '', .) %>%
gsub('#', '', .) %>%
rjson::fromJSON()
return(list("data" = scatdat, "header" = header))
}
data_saxs_PE_pPE <- files_data %>%
pblapply(
cl = NULL,
function(file){
# parse metadata from filename
metadata <- basename(file) %>%
strsplit('_') %>% .[[1]] %>%
.[1:5] %>%
setNames(c("samp", "press", "pdir", "temp", "rep")) %>%
bind_rows()
# load [meta]data from file
datahead <- quietly(load_saxsdat)(file)$result
# bind all metadata and return
datahead$data %>%
bind_cols(metadata) %>%
bind_cols(tibble(
datetime = datahead$header$counters$date,
filename = datahead$header$filename
))
}
) %>%
bind_rows() %>%
# clean up press and temp columns
mutate(across(c(press, temp), ~as.numeric(gsub("[^0-9.-]", "", .x)))) %>%
# convert MPa to bar
mutate(
press = press*10,
datetime = parse_date_time(datetime, orders = "%a %B %d %H:%M:%S %Y")
) %>%
# group by run
group_by(datetime, pdir, press, temp, rep)
# plot profiles by pressure
data_saxs_PE_pPE %>%
filter(!((press>500)&(press<1000))) %>%
filter(q >= 0.03) %>%
filter(q <= 0.5) %>%
arrange(press) %>%
#filter(pdir == "up") %>%
ggplot() +
facet_wrap(~samp, scales="free_y") +
geom_line(aes(x=q, y=iq, color=press, group=filename)) +
theme_pubr() +
#scale_x_log10() +
scale_y_log10() +
scale_color_gradientn(colors = c("#FDBB2C", "#B2201F", "#1A2A6C")) +  # King Yna
labs(
title = "scattering vs. pressure @ 4 deg C",
x = "q (1/Å)", y = "I(q) (au)",
color = "Pressure (bar)"
) +
theme(legend.position = c(0.2, 0.6))
View(data_saxs_PE_pPE)
load_saxsdat = load_saxsdata <- function(file){
# read profile data
scatdat <- file %>%
read_delim(
delim = '  ',
comment = '#',
col_names = c("q", "iq", "err"),
col_types = list(col_double(), col_double(), col_double()),
trim_ws = TRUE
) %>%
mutate_all(as.numeric)
# read header data
header <- file %>%
read_file() %>%
sub(".*### HEADER:", '', .) %>%
gsub('#', '', .) %>%
rjson::fromJSON()
return(list("data" = scatdat, "header" = header))
}
data_saxs_PE_pPE <- files_data %>%
pblapply(
cl = NULL,
function(file){
# parse metadata from filename
metadata <- basename(file) %>%
strsplit('_') %>% .[[1]] %>%
.[1:5] %>%
setNames(c("samp", "press", "pdir", "temp", "rep")) %>%
bind_rows()
# load [meta]data from file
datahead <- quietly(load_saxsdat)(file)$result
# bind all metadata and return
datahead$data %>%
bind_cols(metadata) %>%
bind_cols(tibble(
datetime = datahead$header$counters$date,
filename = datahead$header$filename
))
}
) %>%
bind_rows() %>%
# clean up press and temp columns
mutate(across(c(press, temp), ~as.numeric(gsub("[^0-9.-]", "", .x)))) %>%
# convert MPa to bar
mutate(
press = press*10,
datetime = parse_date_time(datetime, orders = "%a %B %d %H:%M:%S %Y")
) %>%
# group by run
group_by(datetime, pdir, press, temp, rep)
View(data_saxs_PE_pPE)
# plot profiles by pressure
data_saxs_PE_pPE %>%
filter(!((press>500)&(press<1000))) %>%
filter(q >= 0.03) %>%
filter(q <= 0.5) %>%
arrange(press) %>%
#filter(pdir == "up") %>%
ggplot() +
facet_wrap(~samp, scales="free_y") +
geom_line(aes(x=q, y=iq, color=press, group=filename)) +
theme_pubr() +
#scale_x_log10() +
scale_y_log10() +
scale_color_gradientn(colors = c("#FDBB2C", "#B2201F", "#1A2A6C")) +  # King Yna
labs(
title = "scattering vs. pressure @ 4 deg C",
x = "q (1/Å)", y = "I(q) (au)",
color = "Pressure (bar)"
) +
theme(legend.position = c(0.2, 0.6))
data_saxs_PE_pPE$temp %>% unique
files_data = list.files(dir_head, pat_dat, recursive = TRUE, full.names = TRUE)
files_data = files_data[which(str_detect(files_data, "01-raw"))]
# locate data files
dir_head = "/Users/jwinnikoff/Documents/MBARI/deeplipid-biophys-2022/synthlipids"
pat_dat = "\\.dat$"
files_data = list.files(dir_head, pat_dat, recursive = TRUE, full.names = TRUE)
files_data = files_data[which(str_detect(files_data, "01-raw"))]
